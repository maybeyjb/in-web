# 隧道代理常见工具

FRP      NPS      Chisel         传输层

  配置frp

frp建立通道   可以实现跨内网通讯，两个内网的机可以互相通讯。需要配置.ini 文件，这里的serverAddr的地址为跳板机的地址，frps文件配置在跳板机上。frpc放在自己的攻击机上。[[proxies]]是名字可以更改任意，上面的两个配置是尝试连接远程服务地址。下面是尝试将（因为这里没有remoteip地址，所以remotePort就是上面服务端的端口）远程服务端6000 转到 本地客户端（127.0.0.0 这里的本地就是cs的上线服务端kali）的22端口  采用的是tcp协议，备注名字为[[proxies]]

![1732633988373](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942081.png)

配置信息：将远程的6666端口转发到本地的5555端口。

![1732702974123](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942082.png)

成功建立连接：

![1732703083871](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942083.png)

然后在生成2个监听器，分别为1---远程服务端的和2---本地服务端（kali）地址的监听器。用1监听器生成一个后门。然后1后门执行就会访问远程服务端，因为frp会将这上线访问转发到本地服务端，那么2监听器就能获取到上线。1后门执行在一个内网机A中，A是可以访问到外网1远程服务端，而1又转发到内网机B上，那么就实现了AB内网机之间通信。借助了外网服务器作为跳板。frp充当隧道建立连接。

![1732635242104](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942084.png)

生成远程服务器的后门 --  6666.exe：

![1732703667565](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942085.png)

成功上线，并通过frp隧道转发到kali上，成功上线（frp1生成后门，frp2监听上线）---这里的真实环境是 web 机在一个北京内网中，kali的cs在一个武汉内网

![1732703877152](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942086.png)



可以将生成的后门丢微步在线里，会自动溯源到你的跳板机（外网机上），实际你是在内网的服务机（kali）上上线的。有一定的隐藏，防溯源。         frps    服务端         frpc  客户端             socks要看入站检测（通过节点进去），端口映射要看出站检测（让他把自己的端口映射出来）

####   frp 

信息收集：建立socks节点做信息收集             端口映射转发做信息收集

   frp建立socks节点。上面frp的客户端是kali主机，但是如果还在kali上建立socks节点，kali上没有2网段，还是访问不到目标的2网段内网口。所以节点需要在目标139的外网口上建立

在被控机web上执行frpc，将远程服务端的6000端口成为socks代理，接下来只要通讯服务器的代理就可以通讯到客户端（被控机）

![1732708755237](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942087.png)

配置frpsocks.ini文件，让服务器开一个web页面。7000端口是用来通讯的，7500是用来看web页面的

![1732709310211](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942088.png)

执行后，可以看到frp通讯的一些信息：

![1732709568486](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942089.png)

成功建立socks节点，这里注意：这个socks的ini ，客户端的编写一定要注意书写规范（已踩坑）

![1732711385101](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942090.png)

这里配置代理前还是在本机（武汉内网）访问不到目标内网主机：

![1732711469615](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942091.png)

配置代理，成功访问：

![1732711597803](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942092.png)



用到frp建立socks的场景就是：拿到目标的webshell后但是被出入站等原因阻止导致上线不了cs，而又要对目标主机进行信息打点（收集），那么这时就用不了cs来建立socks节点，所以就上传frp到被控机创建socks节点。                                                                                                                  条件：出站没限制。------  这里是相当于用被控机来访问内部网络，（看上面的图，为2.11的内网口）所以没限制就是指的是能访问内网口没限制，不是指出站都没限制。

  端口映射，这下相当于是以目标的139网段为跳板机来访问内网2网段。将内网段2的流量映射到外部服务器上。这两个方法差异还是出入的问题：

![1732714593709](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942093.png)

成功代理，访问服务器8888端口：---代理转发

![1732714659626](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942094.png)

#### 1h04 nps     

配置nps：ini / conf  文件

![1732715155373](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942095.png)

打开页面：     nps服务端 

![1732715251108](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942096.png)

 npc 客户端，新建客户端：

![1732715614970](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942097.png)

客户端执行命令：

![1732715611109](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942098.png)

新增tcp隧道，将服务端6666端口转发到本地（谁执行的客户端命令---kali）5555端口：

![1732715763204](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942099.png)

![1732715776156](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942100.png)

生成后门，监听上线--通过tcp隧道转发：

![1732715913620](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942101.png)

##### socks节点：

这里就不能用刚才的kali为客户端，因为kali通讯不到内网机（2.11网段），需要在被控机上建立客户端socks：

![1732716388883](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942102.png)

上面web隧道中选择socks代理：

![1732716085384](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942103.png)

插件或者Proxifier设置:

![1732716664025](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942104.png)

   

##### 端口映射 

访问服务端8899相当于访问192.168.2.22:80

![1732716752088](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942105.png)

![1732716834453](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942106.png)

#### chisel:

1h24 较前面的两款较为冷门-------流量特征好改

服务端打开：c2上线：

![1732717569073](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942107.png)

 还有一样1后门，2监听。web执行1（6666.exe）后2监听上线。命令：建立与8.152.160.76:1234的连接，将远程的6666端口的流量给到自己192.168.139.128:5555端口![1732717540398](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942108.png)

![1732717870520](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942109.png)

socks节点：

![1732718527371](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942110.png)

代理转发：

![1732718482456](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942111.png)

访问成功：

![1732718498526](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506170942112.png)

